# Testing Guide — Astra Library

ملاحظة سريعة: افترض أن لديك بيئة XAMPP تعمل ووردبريس مُثبت محليًا في `C:\xampp\htdocs\library`.

1) المتطلبات المسبقة
- شغّل Apache وMySQL عبر XAMPP.
- فعّل الثيم `Astra Library Child` من لوحة التحكم → المظهر.

2) فحص التسجيلات والـ CPT
- من لوحة المسؤول اذهب إلى `Books` → `Add New`.
- جهّز كتابًا جديدًا: عنوان، وصف، محتوى، ثم املأ الحقول الإضافية تحت "Book Details":
  - `Cover Image`: اضغط "Set cover" لاختيار صورة عبر مكتبة الوسائط.
  - `PDF File URL (or Download Monitor ID)`: أدخل رابطًا مباشرًا أو رقم Download Monitor ID.
  - `Short Description`, `Publication Year`, `ISBN`.
- عيّن `Authors`, `Publisher`, و`Genre` ثم انشر.

3) مراجعة صفحة الكتاب الفردي
- افتح رابط الكتاب المنشور (single view). تحقّق من:
  - ظهور الغلاف أو الصورة البارزة.
  - زر "Download PDF" يعمل (يفتح الرابط أو ينفذ shortcode Download Monitor).
  - زر المفضلة يعمل (يحتاج تسجيل دخول).
  - واجهة التقييم تظهر وتستجيب عند النقر على النجوم.

4) اختبار المفضلات
- سجّل دخول مستخدم اختبار (مثلاً `admin` أو مستخدم غير مشرف).
- اضغط زر المفضلة ثم افتح صفحة `My Library` (إنشِئ صفحة جديدة واختر قالب `My Library` أو ضع `page-my-library.php` في الصفحة).
- تحقق من أن الكتاب ظهر في القائمة.

5) اختبار التقييم
- سجّل دخول مستخدم مختلف (اختبار منع التقييم المزدوج).
- اضغط نجمة للتقييم ثم راجع نص المتوسط (Average) الذي يجب أن يتحدث.
- للتحقق على مستوى البيانات: افتح `phpMyAdmin` أو استعلم جدول usermeta/postmeta:
  - `postmeta` : `_rating_count`, `_rating_sum` لمعرّف الكتاب.
  - `usermeta` : `_library_ratings` لحسابات المستخدمين.

6) اختبار البحث (Relevanssi)
- إن لم يكن مثبتًا، ثبت الإضافة `Relevanssi` من لوحة الإضافات.
- من إعدادات Relevanssi، أعد بناء الفهرس.
- ابحث بكلمات موجودة في `Short Description` أو `ISBN` أو أسماء المؤلفين. يجب أن تظهر الكتب في النتائج.

7) اختبار Download Monitor (إن وُجد)
- إن كان لديك Download Monitor مثبتًا:
  - أضف Download جديد واحصل على رقمه (ID).
  - ضع هذا الرقم في حقل PDF في Book (كمعرف)، احفظ ثم افتح صفحة الكتاب للتأكد من عمل shortcode.

8) اختبار النسخ الاحتياطي
- افتح PowerShell في `C:\xampp\htdocs\library\scripts` وشغّل:

```powershell
.\backup.ps1
```

تأكد من إنشاء مجلد `backups\<timestamp>` مع ملف SQL وZIP للملفات.

9) فحوصات أمان سريعة
- تحقق أن محرر الملفات معطل عبر اللوحة (Appearance → Editor يجب أن لا يعمل).
- تأكد من تعطيل XML-RPC (جرّب الوصول إلى `http://localhost/library/xmlrpc.php` ويجب أن يرفض الطلب أو يعيد استجابة فارغة).

10) Git ونسخة الالتزام
- تأكد من أن التغييرات محفوظة في Git:

```powershell
git status
git add -A
git commit -m "Test: verify book CPT and UI"
```

مشكلات شائعة وحلول مختصرة
- لا يظهر الغلاف؟ تأكد من أن الحقل `_book_cover_id` يحتوي على معرف مرفق صالح أو أن الصورة موجودة كمرفق.
- زر المفضلة لا يعمل؟ تحقق من أن المستخدم مسجل الدخول وأن `admin-ajax.php` يعمل.
- التقييم لا يتحدث؟ افتح Console في المتصفح وابحث عن أخطاء AJAX.

التالي
- بعد اختبار كل شيء، أخبرني بنتائجك (أخطاء أو تحسينات مطلوبة). أستطيع كتابة اختبارات أوتوماتيكية إضافية أو تحسين الواجهات بحسب الملاحظات.
